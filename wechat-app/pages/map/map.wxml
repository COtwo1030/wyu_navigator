<navigation-bar extClass="nav-default" title="{{nav.title}}" back="{{nav.back}}" animated="{{nav.animated}}"></navigation-bar>
<view class="maparea">
  <map
    id="map"
    longitude="{{longitude}}"
    latitude="{{latitude}}"
    scale="{{scale}}"
    polyline="{{polyline}}"
    markers="{{markers}}"
    bindmarkertap="onMarkerTap"
    enable-3D="{{enable3D}}"
    enable-overlooking="{{enableOverlooking}}"
    skew="{{skew}}"
    enable-zoom="{{mapSettings.enableZoom}}"
    show-compass="{{mapSettings.showCompass}}"
    show-location="{{mapSettings.showLocation}}"
    enable-poi="{{showPoi}}"
    class="map">
  </map>

  <view class="route-panel">
    <!-- 核心：左输入 + 右操作 布局 -->
    <view class="route-form">
      <!-- 左侧：起点/终点输入区 -->
      <view class="route-fields">
        <!-- 起点输入 -->
        <view class="route-label {{fromLabel === '起点' ? 'placeholder' : ''}}">
          <view class="dot red"></view>
          <input 
            class="route-input" 
            value="{{searchFromText}}" 
            placeholder="起点" 
            placeholder-style="color:#999" 
            confirm-type="search" 
            bindinput="onInputFrom" 
            bindfocus="onFocusFrom" 
            bindblur="onBlurFrom" 
            bindconfirm="onConfirmFrom"/>
          <view class="clear-btn" wx:if="{{searchFromText || fromCoord}}" bindtap="onClearFrom">×</view>
        </view>
        <!-- 起点建议列表 -->
        <view class="suggest-list" wx:if="{{showFromSuggestions && fromSuggestions.length}}">
          <block wx:for="{{fromSuggestions}}" wx:key="id">
            <view class="suggest-item" bindtap="onPickFromSuggestion" data-index="{{index}}">{{item.name}}</view>
          </block>
        </view>

        <!-- 分割线 + 交换按钮（核心调整：交换按钮居中在分割线右侧） -->
        <view class="route-separator-wrap">
          <view class="route-separator"></view>
          <view class="route-swap" bindtap="onSwap">
            <view class="swap-text">⇅</view>
          </view>
        </view>

        <!-- 终点输入 -->
        <view class="route-label {{toLabel === '终点' ? 'placeholder' : ''}}">
          <view class="dot blue"></view>
          <input 
            class="route-input" 
            value="{{searchToText}}" 
            placeholder="终点" 
            placeholder-style="color:#999" 
            confirm-type="search" 
            bindinput="onInputTo" 
            bindfocus="onFocusTo" 
            bindblur="onBlurTo" 
            bindconfirm="onConfirmTo"/>
          <view class="clear-btn" wx:if="{{searchToText || toCoord}}" bindtap="onClearTo">×</view>
        </view>
        <!-- 终点建议列表 -->
        <view class="suggest-list" wx:if="{{showToSuggestions && toSuggestions.length}}">
          <block wx:for="{{toSuggestions}}" wx:key="id">
            <view class="suggest-item">
              <view class="suggest-text" bindtap="onPickToSuggestion" data-index="{{index}}">{{item.name}}</view>
              <view class="suggest-go" catchtap="onQuickNavTo" data-index="{{index}}">
                <image class="suggest-icon" src="/images/tabbar/destination.png" mode="aspectFit"></image>
                <view class="suggest-go-text">到这去</view>
              </view>
            </view>
          </block>
        </view>
      </view>

      <!-- 右侧：交通方式 + 路线按钮（交换按钮已移到分割线，此处仅保留交通+路线） -->
      <view class="route-actions">
        <!-- 交通方式（在上） -->
        <view class="mode-tabs">
          <view class="mode-tab {{routeMode === 'walking' ? 'active' : ''}}" data-mode="walking" bindtap="onSelectMode">步行</view>
          <view class="mode-tab {{routeMode === 'bicycling' ? 'active' : ''}}" data-mode="bicycling" bindtap="onSelectMode">骑行</view>
          <view class="mode-tab {{routeMode === 'driving' ? 'active' : ''}}" data-mode="driving" bindtap="onSelectMode">驾车</view>
        </view>
        <!-- 路线按钮（单独展示，大小为交通按钮3倍+绿色） -->
        <view class="route-btn" bindtap="onRoute">路线</view>
      </view>
  </view>

  <!-- 路线信息 -->
  <view class="route-info"><view class="info-text">{{routeInfo}}</view></view>
  </view>
  
  <!-- 地点弹窗（复用地点页样式与结构） -->
  <view wx:if="{{showModal}}" class="mask" bindtap="onCloseModal"></view>
  <view wx:if="{{showModal}}" class="dialog" catchtap="noop">
    <view class="dlg-name">{{modalItem.name}}</view>
    <image wx:if="{{modalItem.img}}" class="dlg-cover" src="{{modalItem.img}}" mode="aspectFill" bindtap="onPreviewImage"></image>
    <view class="dlg-desc">{{modalItem.desc}}</view>
    <view class="dlg-actions">
      <button class="dlg-btn" bindtap="onSetAsTo">设为终点</button>
      <button class="dlg-btn primary" bindtap="onNavNow">一键导航</button>
    </view>
  </view>
</view>
